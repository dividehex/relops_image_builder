version: 1.0.{build}

image: Visual Studio 2015

environment:
  AWS_ACCESS_KEY_ID:
    secure: orM9wQ470RLmboumGqJwZt5Vpk6j+nKLKqWVP1bpZAo=
  AWS_SECRET_ACCESS_KEY:
    secure: 6Z+k1EcNjtzaqZcycuVjtrYo+YQXngBqe2Rvmo+7u9evQz3lI1KUXuK406PZBPKR
  bucket: relops-image-builder
  iso: en_windows_10_enterprise_version_1703_updated_july_2017_x64_dvd_10925376.iso

# Maximum number of concurrent jobs for the project
max_jobs: 1

platform: x64

install:
  - ps: Write-Host "Downloading ISO..."
  - cmd: aws --version
  - cmd: aws s3 cp s3://%bucket%/ISOs/%iso% .

build_script:
  - ps: Write-Host "Converting ISO to VHD..."
  - ps: .\Convert-WindowsImage.ps1 -SourcePath .\$env:iso -Edition Enterprise -VHDPath .\win1064_build.vhd
  - cmd: dir

artifacts:
  # pushing a single file
  - path: .\win1064_build.vhd


deploy:
  provider: S3
  access_key_id:
    secure: orM9wQ470RLmboumGqJwZt5Vpk6j+nKLKqWVP1bpZAo=
  secret_access_key:
    secure: 6Z+k1EcNjtzaqZcycuVjtrYo+YQXngBqe2Rvmo+7u9evQz3lI1KUXuK406PZBPKR
  region: us-west-2
  bucket: relops-image-builder
  folder: VHDs

